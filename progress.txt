# Ralph Progress Log - Phonics Flashcards

Branch: ralph/phonics-flashcards
Started: 2026-02-05

## Codebase Patterns
- Models use file-scoped namespaces (`namespace NowThenNext.Models;`)
- Models use default property values (e.g. `string.Empty`, `new()`)
- WASM build is broken in local environment (ComputeWasmBuildAssets MSB4216 error) - pre-existing issue, not caused by code changes
- Use `dotnet build` to verify C# compilation (check for 0 C# errors even if WASM toolchain fails)
- Heredoc commit messages fail due to sandbox tmp restrictions - use inline `-m` flag instead

---

## 2026-02-05 - US-038
- What was implemented: PhonicsPhase, PhonicsWeek, and GraphemeCard data models
- Files changed: `src/NowThenNext/Models/PhonicsModels.cs` (new)
- **Learnings for future iterations:**
  - Follow existing model pattern: file-scoped namespace, default property values
  - WASM build fails in local env with MSB4216/MSB4027 - this is pre-existing and not caused by code changes. Zero C# compilation errors confirms build is OK.
  - Sandbox doesn't allow heredoc temp files in commit messages - use inline `-m` flag
---

## 2026-02-05 - US-038b
- What was implemented: IPhonicsDataService interface and PhonicsDataService with Phase 2 (8 teaching weeks, 30 GPCs) and Phase 3 (4 weeks, 14 GPCs) data
- Files changed:
  - `src/NowThenNext/Services/IPhonicsDataService.cs` (new) - interface with GetAllPhases(), GetPhase(), GetGraphemeCard()
  - `src/NowThenNext/Services/PhonicsDataService.cs` (new) - full implementation with BuildWeek helper and hardcoded GPC data
  - `src/NowThenNext/Program.cs` (modified) - registered IPhonicsDataService as singleton
- **Learnings for future iterations:**
  - Phase 2 Week 6 (assessment) is skipped - no cards for that week
  - Phase 3 Week 2 has two "oo" graphemes (long/short) which need distinct IDs: `p3-w2-oo_long` and `p3-w2-oo_short`. These are constructed manually instead of using the BuildWeek helper since the helper generates IDs from grapheme names (which would collide)
  - The BuildWeek helper method uses `ref int orderIndex` to maintain sequential ordering across weeks within a phase
  - Service is registered as Singleton since it holds only static data
---

## 2026-02-05 - US-038c
- What was implemented: Phase 4 (consonant clusters) and Phase 5 (alternative spellings, split digraphs, alternative pronunciations, silent letters) data added to PhonicsDataService
- Files changed:
  - `src/NowThenNext/Services/PhonicsDataService.cs` (modified) - added BuildPhase4() and BuildPhase5(), updated BuildAllPhases()
- **Learnings for future iterations:**
  - Phase 4 uses "weeks" to group initial clusters (Week 1, 21 cards) and final clusters (Week 2, 12 cards). Some clusters appear in both (sk, st) but have unique IDs due to different week numbers
  - Phase 5 uses 4 weeks: Week 1 (new spellings, 13 cards), Week 2 (split digraphs, 5 cards), Week 3 (alternative pronunciations, 20 manual cards), Week 4 (silent letters, 4 cards)
  - Alternative pronunciations need manual card construction (like Phase 3 oo_long/oo_short) because multiple cards share the same grapheme. IDs use suffixed format: `p5-w3-ow_snow`, `p5-w3-ch_chef` etc.
  - Split digraph graphemes use underscore format: `a_e`, `e_e`, `i_e`, `o_e`, `u_e`
  - Alternative pronunciation KeywordHint uses "X can say Y" format instead of "X is for Y" to distinguish from primary pronunciation cards
---

## 2026-02-05 - US-040
- What was implemented: Phonics button group on home page with calm-phonics colour scheme
- Files changed:
  - `src/NowThenNext/Pages/Home.razor` (modified) - added Group 4: Phonics with "Aa" SVG text icon, navigates to /phonics
  - `src/NowThenNext/wwwroot/index.html` (modified) - added calm-phonics (#7BA3C4), calm-phonics-dark (#6890B0), calm-phonics-light (#9BBDD6) to Tailwind config
- **Learnings for future iterations:**
  - The home page uses a consistent group pattern: menu-group > group-label + group-buttons > menu-button with menu-icon + menu-text
  - SVG text elements work well for letter-based icons (used `<text>` element for "Aa")
  - Tailwind color classes follow pattern: bg-calm-{name} and group-hover:bg-calm-{name}-dark
  - No browser verification available - manual testing needed
---

## 2026-02-05 - US-039
- What was implemented: IPhonicsProgressService interface and PhonicsProgressService with localStorage persistence
- Files changed:
  - `src/NowThenNext/Services/IPhonicsProgressService.cs` (new) - interface with MarkCompleted, IsCompleted, GetNextUnlocked, GetPhaseProgress, ResetPhase, ResetAll
  - `src/NowThenNext/Services/PhonicsProgressService.cs` (new) - implementation using localStorage key "phonics-progress", stores a HashSet<string> of completed grapheme IDs
  - `src/NowThenNext/Program.cs` (modified) - registered IPhonicsProgressService as scoped service
- **Learnings for future iterations:**
  - Progress is stored as a simple JSON HashSet<string> of completed card IDs - much simpler than the image storage
  - PhonicsProgressService depends on IPhonicsDataService to look up phase data for GetNextUnlocked and GetPhaseProgress
  - Registered as Scoped (not Singleton) because it depends on IJSRuntime which is scoped in Blazor WASM
  - GetNextUnlockedGraphemeIdAsync returns null when all cards in a phase are completed
  - ResetPhaseAsync uses HashSet.ExceptWith to remove only the target phase's card IDs
---
