# Ralph Progress Log - Phonics Card Images

Branch: ralph/phonics-card-images
Started: 2026-02-09

## Codebase Patterns
- Phonics data is hardcoded in `PhonicsDataService.cs` (singleton), uses `BuildWeek` helper for most weeks
- Phase 5 Week 3 manually constructs cards (duplicate graphemes with suffixed IDs like `oo_long`, `ch_chef`)
- GraphemeCard ID format: `p{phase}-w{week}-{grapheme}`
- PhonicsCard.razor uses `OnParametersSetAsync` (not OnInitializedAsync) because Blazor reuses the component for same-route navigation
- Image path rendering pattern: relative paths like `images/dinosaurs/trex.png` work via the `card.ImageData.Contains('/')` branch in LearningCardGrid.razor
- E2E tests use relative href selectors (e.g. `a[href='phonics']` not `a[href='/phonics']`)
- Dev server: localhost:5161

---

## 2026-02-09 - US-065
- Added `public string? ImagePath { get; set; }` to GraphemeCard in Models/PhonicsModels.cs
- Files changed: src/NowThenNext/Models/PhonicsModels.cs
- **Learnings for future iterations:**
  - Nullable string property (string?) allows cards without images to remain unchanged
  - Build passes clean with 0 errors
---

## 2026-02-09 - US-066
- Added tap-to-flip interaction on PhonicsCard page
- `ShowImage` bool toggle + `ToggleImage()` method in code-behind, reset in `OnParametersSetAsync`
- `HasImage` computed property checks `Card?.ImagePath` is not null/empty
- Razor template: `@onclick="ToggleImage"` on `.flashcard` div, conditional rendering of image vs grapheme
- Example word with highlighted grapheme stays visible on both sides
- Cards without ImagePath: no cursor change, tap does nothing (guarded by `HasImage` check)
- CSS: `.flashcard-tappable` class adds cursor pointer and hover shadow; `.card-image-display` / `.card-image` for image rendering
- Files changed: src/NowThenNext/Pages/PhonicsCard.razor, src/NowThenNext/Pages/PhonicsCard.razor.cs
- **Learnings for future iterations:**
  - The flip is not a CSS 3D flip â€” it's a content swap (conditional rendering) which is simpler and more accessible
  - `HasImage` property avoids repeated null checks in both razor and code-behind
  - The `.flashcard-tappable` class is conditionally applied so cards without images don't show pointer cursor
  - Example word moved below the conditional block so it's always visible regardless of flip state
  - E2E tests pass: 84/84 (no regressions)
---

## 2026-02-09 - US-067 to US-070
- Added Noto Color Emoji (Apache 2.0) PNG images for phonics cards across all phases
- 56 PNG files copied to `wwwroot/images/phonics/`, named by card ID (e.g. `p2-w1-s.png`)
- Images sourced from Google Noto Color Emoji 128px PNGs, mapped to Unicode codepoints via shell script
- Added `CardsWithImages` HashSet and `AssignImagePaths()` method to PhonicsDataService.cs
- Abstract/hard-to-illustrate words skipped (no ImagePath set, card doesn't flip)
- Files changed: src/NowThenNext/Services/PhonicsDataService.cs, 56 PNG files in wwwroot/images/phonics/
- **Learnings for future iterations:**
  - Centralized `AssignImagePaths` method with HashSet is cleaner than modifying `BuildWeek` helper signature
  - Noto Color Emoji provides good coverage for concrete nouns but not all words (abstract words naturally excluded)
  - Shell script approach for mapping card IDs to emoji codepoints was efficient for bulk operations
  - E2E tests pass: 84/84 (no regressions)
---

## 2026-02-09 - US-071
- Added 4 E2E tests for phonics card flip interaction to PhonicsTests.cs
- Tests: FlashcardFlip_TappingCardWithImage_ShowsImage, FlashcardFlip_TappingAgain_ShowsGrapheme, FlashcardFlip_NavigatingToNextCard_ResetsFlipState, FlashcardFlip_GotItWorksAfterFlipping
- Tests navigate directly to `/phonics/2/card/p2-w1-s` (the "s" card with sun image) for flip tests
- Files changed: tests/NowThenNext.Tests.E2E/Tests/PhonicsTests.cs
- **Learnings for future iterations:**
  - Direct URL navigation to specific phonics cards works well for testing (no need to navigate through the UI)
  - `.card-image` selector reliably distinguishes image-side from grapheme-side
  - E2E tests pass: 88/88 (84 existing + 4 new)
---
