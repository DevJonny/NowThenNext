# Ralph Progress Log - Phonics Flashcards

Branch: ralph/phonics-flashcards
Started: 2026-02-05

## Codebase Patterns
- Models use file-scoped namespaces (`namespace NowThenNext.Models;`)
- Models use default property values (e.g. `string.Empty`, `new()`)
- WASM build is broken in local environment (ComputeWasmBuildAssets MSB4216 error) - pre-existing issue, not caused by code changes
- Use `dotnet build` to verify C# compilation (check for 0 C# errors even if WASM toolchain fails)
- Heredoc commit messages fail due to sandbox tmp restrictions - use inline `-m` flag instead
- **E2E test href selectors**: Use RELATIVE paths in selectors (e.g. `a[href='phonics']` NOT `a[href='/phonics']`) - Blazor renders relative hrefs in the DOM
- **Blazor same-route navigation**: Use `OnParametersSetAsync` (not `OnInitializedAsync`) for pages with changing route parameters - Blazor reuses the component instance

---

## 2026-02-05 - US-038
- What was implemented: PhonicsPhase, PhonicsWeek, and GraphemeCard data models
- Files changed: `src/NowThenNext/Models/PhonicsModels.cs` (new)
- **Learnings for future iterations:**
  - Follow existing model pattern: file-scoped namespace, default property values
  - WASM build fails in local env with MSB4216/MSB4027 - this is pre-existing and not caused by code changes. Zero C# compilation errors confirms build is OK.
  - Sandbox doesn't allow heredoc temp files in commit messages - use inline `-m` flag
---

## 2026-02-05 - US-038b
- What was implemented: IPhonicsDataService interface and PhonicsDataService with Phase 2 (8 teaching weeks, 30 GPCs) and Phase 3 (4 weeks, 14 GPCs) data
- Files changed:
  - `src/NowThenNext/Services/IPhonicsDataService.cs` (new) - interface with GetAllPhases(), GetPhase(), GetGraphemeCard()
  - `src/NowThenNext/Services/PhonicsDataService.cs` (new) - full implementation with BuildWeek helper and hardcoded GPC data
  - `src/NowThenNext/Program.cs` (modified) - registered IPhonicsDataService as singleton
- **Learnings for future iterations:**
  - Phase 2 Week 6 (assessment) is skipped - no cards for that week
  - Phase 3 Week 2 has two "oo" graphemes (long/short) which need distinct IDs: `p3-w2-oo_long` and `p3-w2-oo_short`. These are constructed manually instead of using the BuildWeek helper since the helper generates IDs from grapheme names (which would collide)
  - The BuildWeek helper method uses `ref int orderIndex` to maintain sequential ordering across weeks within a phase
  - Service is registered as Singleton since it holds only static data
---

## 2026-02-05 - US-038c
- What was implemented: Phase 4 (consonant clusters) and Phase 5 (alternative spellings, split digraphs, alternative pronunciations, silent letters) data added to PhonicsDataService
- Files changed:
  - `src/NowThenNext/Services/PhonicsDataService.cs` (modified) - added BuildPhase4() and BuildPhase5(), updated BuildAllPhases()
- **Learnings for future iterations:**
  - Phase 4 uses "weeks" to group initial clusters (Week 1, 21 cards) and final clusters (Week 2, 12 cards). Some clusters appear in both (sk, st) but have unique IDs due to different week numbers
  - Phase 5 uses 4 weeks: Week 1 (new spellings, 13 cards), Week 2 (split digraphs, 5 cards), Week 3 (alternative pronunciations, 20 manual cards), Week 4 (silent letters, 4 cards)
  - Alternative pronunciations need manual card construction (like Phase 3 oo_long/oo_short) because multiple cards share the same grapheme. IDs use suffixed format: `p5-w3-ow_snow`, `p5-w3-ch_chef` etc.
  - Split digraph graphemes use underscore format: `a_e`, `e_e`, `i_e`, `o_e`, `u_e`
  - Alternative pronunciation KeywordHint uses "X can say Y" format instead of "X is for Y" to distinguish from primary pronunciation cards
---

## 2026-02-05 - US-040
- What was implemented: Phonics button group on home page with calm-phonics colour scheme
- Files changed:
  - `src/NowThenNext/Pages/Home.razor` (modified) - added Group 4: Phonics with "Aa" SVG text icon, navigates to /phonics
  - `src/NowThenNext/wwwroot/index.html` (modified) - added calm-phonics (#7BA3C4), calm-phonics-dark (#6890B0), calm-phonics-light (#9BBDD6) to Tailwind config
- **Learnings for future iterations:**
  - The home page uses a consistent group pattern: menu-group > group-label + group-buttons > menu-button with menu-icon + menu-text
  - SVG text elements work well for letter-based icons (used `<text>` element for "Aa")
  - Tailwind color classes follow pattern: bg-calm-{name} and group-hover:bg-calm-{name}-dark
  - No browser verification available - manual testing needed
---

## 2026-02-05 - US-041
- What was implemented: Phase selection screen at /phonics with 4 phase cards showing progress bars
- Files changed:
  - `src/NowThenNext/Pages/PhonicsPhases.razor` (new) - page with back button, 4 phase cards, progress bars
- **Learnings for future iterations:**
  - Used inline @code block instead of code-behind .razor.cs since the logic is simple (no complex state management)
  - Back button uses calm-phonics colour (#7BA3C4) instead of calm-primary to match the phonics section theme
  - Progress percentage uses `.ToString("F0")` for clean integer display in CSS width
  - Phase cards link to /phonics/{phaseId} and show description + "X/Y sounds" count
  - Responsive: single column on mobile, 2 columns on tablet (768px+)
---

## 2026-02-05 - US-042
- What was implemented: Sound list page at /phonics/{PhaseId} with graphemes grouped by week, three visual states
- Files changed:
  - `src/NowThenNext/Pages/PhonicsSoundList.razor` (new) - sound list with completed/current/locked tiles
- **Learnings for future iterations:**
  - Three card states: Completed (muted bg, checkmark), Current (white bg, phonics-blue border + shadow), Locked (grey bg, lock icon, not tappable)
  - Locked tiles use `<div>` (not `<a>`) to prevent navigation
  - Completed and current tiles use `<a href>` for navigation to flashcard
  - CompletedIds built as HashSet for O(1) lookups in GetCardState()
  - Sound grid uses auto-fill with minmax(4rem, 1fr) for responsive columns
---

## 2026-02-05 - US-043
- What was implemented: Flashcard display page at /phonics/{PhaseId}/card/{GraphemeId}
- Files changed:
  - `src/NowThenNext/Pages/PhonicsCard.razor` (new) - large grapheme display, highlighted example word, keyword hint
- **Learnings for future iterations:**
  - HighlightGrapheme uses case-insensitive IndexOf to find grapheme within word, wraps in span with grapheme-highlight class
  - Must use HtmlEncode on all parts before building markup to prevent XSS, then cast to MarkupString
  - Grapheme font size: 5rem mobile, 7rem tablet (well above 72px minimum)
  - Split digraphs like "a_e" won't highlight in "cake" since "a_e" doesn't appear as substring - acceptable for now
  - Route parameter GraphemeId is string type since card IDs are formatted strings like "p2-w1-s"
---

## 2026-02-05 - US-045
- What was implemented: Reset progress buttons with confirmation modals on both phonics pages
- Files changed:
  - `src/NowThenNext/Pages/PhonicsPhases.razor` (modified) - added Reset All Progress button and confirmation modal
  - `src/NowThenNext/Pages/PhonicsSoundList.razor` (modified) - added Reset Phase Progress button and confirmation modal
- **Learnings for future iterations:**
  - Modal pattern: modal-overlay with @onclick to cancel, modal-content with @onclick:stopPropagation to prevent backdrop clicks
  - Reset button uses subtle style (transparent bg, border) with hover state changing to calm-warning colour
  - After reset, both pages call LoadState/LoadProgress to refresh the UI
  - Modal confirm button uses calm-warning colour (#D4A06A) to indicate destructive action without harsh red
  - Modal styles are duplicated between pages - could be extracted to shared CSS if more modals are needed
---

## 2026-02-05 - US-046
- What was implemented: E2E tests for phonics home button and phase selection screen
- Files changed:
  - `tests/NowThenNext.Tests.E2E/Tests/PhonicsTests.cs` (new) - 4 tests: home button nav, 4 phases visible, phase card nav, back button
- **Learnings for future iterations:**
  - CRITICAL: Use relative paths in href selectors (`a[href='phonics']` not `a[href='/phonics']`) - Blazor keeps relative hrefs in the DOM
  - Kill stray dotnet processes before running tests (`pkill -f "dotnet"`) to avoid port conflicts
  - For phase selection test, navigate to /phonics, clear localStorage, then reload to get clean state
  - All 4 tests pass in ~4 seconds
---

## 2026-02-05 - US-047
- What was implemented: E2E tests for sound list and flashcard display/navigation
- Files changed:
  - `tests/NowThenNext.Tests.E2E/Tests/PhonicsTests.cs` (modified) - added 6 new tests
  - `src/NowThenNext/Pages/PhonicsCard.razor` (modified) - fixed: changed OnInitializedAsync to OnParametersSetAsync
- **Learnings for future iterations:**
  - CRITICAL: Blazor same-route navigation (e.g. card/A to card/B) does NOT re-run OnInitializedAsync. Must use OnParametersSetAsync for pages with changing route parameters.
  - Test pattern for clearing state: navigate, wait for selector, clear localStorage, navigate again, wait again
  - For "Got it!" test, need to wait for the grapheme-display to update after navigation - Playwright auto-waits with locator assertions
  - All 10 phonics tests pass in ~13 seconds
---

## 2026-02-05 - US-044
- What was implemented: Flashcard navigation with Got it! button, prev/next arrows, and phase complete message
- Files changed:
  - `src/NowThenNext/Pages/PhonicsCard.razor` (modified) - added navigation bar, Got it! completion, phase complete state
- **Learnings for future iterations:**
  - Got it! button only shows for the current unlocked card (IsCurrentUnlocked flag)
  - Next arrow is disabled unless next card is completed or is the current unlocked (prevents skipping ahead)
  - Previous arrow always available except on first card
  - HandleGotIt marks complete then checks GetNextUnlockedGraphemeIdAsync - null means phase complete
  - Phase complete shows celebration message with back button, uses ShowPhaseComplete flag
  - Nav bar uses justify-content: space-between with prev/got-it/next layout; empty div placeholder when Got it! isn't shown
  - Blazor WASM same-page navigation (NavigateTo) re-renders the component but doesn't re-run OnInitializedAsync for same route template
---

## 2026-02-05 - US-039
- What was implemented: IPhonicsProgressService interface and PhonicsProgressService with localStorage persistence
- Files changed:
  - `src/NowThenNext/Services/IPhonicsProgressService.cs` (new) - interface with MarkCompleted, IsCompleted, GetNextUnlocked, GetPhaseProgress, ResetPhase, ResetAll
  - `src/NowThenNext/Services/PhonicsProgressService.cs` (new) - implementation using localStorage key "phonics-progress", stores a HashSet<string> of completed grapheme IDs
  - `src/NowThenNext/Program.cs` (modified) - registered IPhonicsProgressService as scoped service
- **Learnings for future iterations:**
  - Progress is stored as a simple JSON HashSet<string> of completed card IDs - much simpler than the image storage
  - PhonicsProgressService depends on IPhonicsDataService to look up phase data for GetNextUnlocked and GetPhaseProgress
  - Registered as Scoped (not Singleton) because it depends on IJSRuntime which is scoped in Blazor WASM
  - GetNextUnlockedGraphemeIdAsync returns null when all cards in a phase are completed
  - ResetPhaseAsync uses HashSet.ExceptWith to remove only the target phase's card IDs
---

## 2026-02-06 - US-048
- What was implemented: E2E tests for progress reset functionality (5 new tests)
- Files changed:
  - `tests/NowThenNext.Tests.E2E/Tests/PhonicsTests.cs` (modified) - added 5 reset progress tests
- Tests added:
  - ResetPhase_ShowsConfirmationModal
  - ResetPhase_ConfirmClearsProgressForThatPhase
  - ResetAll_ShowsConfirmationModal
  - ResetAll_ConfirmClearsProgressForAllPhases
  - ResetPhase_CancelDoesNotClearProgress
- **Learnings for future iterations:**
  - Reset tests follow a setup pattern: complete a sound first to have progress, then test reset behavior
  - Modal visibility can be asserted with `ToBeHiddenAsync` after cancel to confirm dismissal
  - Phase count text selector `.phase-card:has-text('Phase 2') .phase-count` works for verifying phase-specific progress on the selection screen
  - All 15 phonics tests pass in ~25 seconds
---
